<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>We Pull at Two – Dashboard</title>

<style>
body {
  margin: 0;
  padding: 60px 40px;
  background: radial-gradient(circle at top, #1b1f28, #0d1117 70%);
  font-family: "Segoe UI", sans-serif;
  color: #e5e7eb;
}

h1 {
  text-align: center;
  font-size: 36px;
  letter-spacing: 2px;
  margin-bottom: 20px;
  color: #d1d5db;
  text-transform: uppercase;
}

/* EVENT BAR */
#event-bar {
  margin-bottom: 40px;
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
  gap: 30px;
}

.card {
  background: rgba(30, 41, 59, 0.6);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 16px;
  padding: 30px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
}

.card h2 {
  margin-top: 0;
  margin-bottom: 20px;
  font-size: 20px;
  color: #f3f4f6;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  padding-bottom: 8px;
}

/* PROGRESS BARS */
.progress-row {
  margin-bottom: 12px;
}

.progress-label {
  display: flex;
  justify-content: space-between;
  font-size: 13px;
  margin-bottom: 4px;
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: rgba(255,255,255,0.08);
  border-radius: 6px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #22c55e, #16a34a);
  width: 0%;
  transition: width 0.6s ease;
}

.raid-title {
  margin-top: 18px;
  margin-bottom: 6px;
  font-size: 14px;
  font-weight: bold;
  color: #cbd5e1;
}

.placeholder {
  color: #9ca3af;
  font-style: italic;
}
</style>
</head>

<body>

<h1>We Pull at Two – Live Guild Dashboard</h1>

<div id="event-bar"></div>

<div class="grid">

  <!-- GUILD -->
  <div class="card" id="guild">
    <h2>Gildenübersicht</h2>
    <p>Lade Daten...</p>
  </div>

  <!-- RAID -->
  <div class="card" id="raid">
    <h2>Raid Progress – Midnight Season 1</h2>
    <p>Lade Daten...</p>
  </div>

  <!-- MYTHIC -->
  <div class="card" id="mythic">
    <h2>Mythic+ Hall of Fame</h2>
    <p class="placeholder">
      Neue Mythic+ Season startet bald.
    </p>
  </div>

</div>

<script>

/* ------------------ GUILD ------------------ */

async function loadGuild() {
  const res = await fetch("/api/guild");
  const data = await res.json();

  document.getElementById("guild").innerHTML = `
    <h2>Gildenübersicht</h2>
    <div style="display:flex; align-items:center; gap:20px;">
      
      <div style="
        width:70px;
        height:70px;
        border-radius:50%;
        background: rgba(${data.backgroundColor.r}, ${data.backgroundColor.g}, ${data.backgroundColor.b}, 1);
        display:flex;
        align-items:center;
        justify-content:center;
        box-shadow:
          0 0 15px rgba(0,0,0,0.6),
          inset 0 0 10px rgba(0,0,0,0.5);
      ">
        <img src="${data.emblemUrl}" 
             style="
               width:52px;
               height:52px;
               filter:
                 brightness(1.4)
                 contrast(1.4)
                 drop-shadow(0 0 4px rgba(0,0,0,0.8));
             ">
      </div>

      <div>
        <p><strong>Name:</strong> ${data.name}</p>
        <p><strong>Realm:</strong> ${data.realm.name}</p>
        <p><strong>Fraktion:</strong> ${data.faction.name}</p>
        <p><strong>Mitglieder:</strong> ${data.member_count}</p>
        <p><strong>Erfolgspunkte:</strong> ${data.achievement_points}</p>
      </div>
    </div>
  `;
}

/* ------------------ RAID ------------------ */

function renderProgress(label, completed, total) {
  const percent = total === 0 ? 0 : (completed / total) * 100;

  return `
    <div class="progress-row">
      <div class="progress-label">
        <span>${label}</span>
        <span>${completed} / ${total}</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width:${percent}%"></div>
      </div>
    </div>
  `;
}

async function loadRaid() {
  const res = await fetch("/api/raid");
  const data = await res.json();

  let html = `<h2>Raid Progress – Midnight Season 1</h2>`;

  data.raids.forEach(raid => {
    html += `
      <div class="raid-title">${raid.name}</div>
      ${renderProgress("Mythic", raid.mythic.completed, raid.mythic.total)}
      ${renderProgress("Heroic", raid.heroic.completed, raid.heroic.total)}
      ${renderProgress("Normal", raid.normal.completed, raid.normal.total)}
    `;
  });

  document.getElementById("raid").innerHTML = html;
}

/* ------------------ WORLD EVENTS ------------------ */

const EVENTS = [
  {
    name: "Dunkelmondjahrmarkt",
    start: "2026-03-01",
    end: "2026-03-07"
  },
  {
    name: "Mondfest",
    start: "2026-02-10",
    end: "2026-02-24"
  },
  {
    name: "Liebe liegt in der Luft",
    start: "2026-02-05",
    end: "2026-02-20"
  }
];

function daysBetween(date1, date2) {
  const diff = date2 - date1;
  return Math.ceil(diff / (1000 * 60 * 60 * 24));
}

function loadEvents() {
  const now = new Date();
  const maxFuture = new Date();
  maxFuture.setDate(now.getDate() + 30);

  let html = `
    <div style="
      display:flex;
      gap:12px;
      overflow-x:auto;
      padding-bottom:10px;
    ">
  `;

  EVENTS.forEach(event => {
    const start = new Date(event.start);
    const end = new Date(event.end);

    if (start > maxFuture) return;

    let status = "";
    let color = "#3b82f6";

    if (now >= start && now <= end) {
      status = "AKTIV";
      color = "#22c55e";
    } else {
      const days = daysBetween(now, start);
      status = `Startet in ${days} Tagen`;
      color = "#facc15";
    }

    html += `
      <div style="
        min-width:220px;
        padding:12px 18px;
        border-radius:12px;
        background:rgba(30,41,59,0.8);
        border:1px solid rgba(255,255,255,0.08);
        box-shadow:0 5px 20px rgba(0,0,0,0.4);
      ">
        <div style="font-weight:bold; margin-bottom:6px;">
          ${event.name}
        </div>
        <div style="color:${color}; font-size:13px;">
          ${status}
        </div>
      </div>
    `;
  });

  html += "</div>";

  document.getElementById("event-bar").innerHTML = html;
}

/* ------------------ INIT ------------------ */

loadGuild();
loadRaid();
loadEvents();

</script>

</body>
</html>
